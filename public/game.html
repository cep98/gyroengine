<!DOCTYPE html>
<html>
<head>
    <title>Laserpointer</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #111;
        }
        #pointer {
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, red 40%, rgba(255,0,0,0.3) 80%);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            filter: drop-shadow(0 0 15px red);
            will-change: transform;
            transition: transform 0.1s linear;
        }
        #debug {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="pointer"></div>
    <div id="debug">Verbinde mit Server...</div>

    <script>
        const pointer = document.getElementById("pointer");
        const debug = document.getElementById("debug");
        const socket = new WebSocket("wss://gyroengine.onrender.com");

        // Einstellungen
        const MAX_ANGLE = 20;
        let targetX = 0, targetY = 0;
        let currentX = 0, currentY = 0;
        let sensitivity = window.innerWidth / (MAX_ANGLE * 2);

        // WebSocket
        socket.onopen = () => debug.textContent = "VERBUNDEN | Warte auf Gyro-Daten";
        socket.onerror = (e) => debug.textContent = "FEHLER: " + e.message;
        
        socket.onmessage = (e) => {
            try {
                const data = JSON.parse(e.data);
                
                if (data.reset) {
                    targetX = targetY = 0;
                    debug.textContent = "ZENTRIERT | Warte auf Daten";
                } 
                else if (typeof data.alpha === 'number') {
                    // Richtungskorrektur
                    let horizontalAngle = (data.alpha > 180 ? data.alpha - 360 : data.alpha) * -1;
                    horizontalAngle = Math.max(-MAX_ANGLE, Math.min(MAX_ANGLE, horizontalAngle));
                    
                    let verticalAngle = (data.beta || 0) * -1;
                    verticalAngle = Math.max(-MAX_ANGLE, Math.min(MAX_ANGLE, verticalAngle));
                    
                    // Positionsberechnung
                    targetX = horizontalAngle * sensitivity;
                    targetY = verticalAngle * sensitivity * 0.8;
                    
                    debug.innerHTML = `X: ${targetX.toFixed(1)}px | Y: ${targetY.toFixed(1)}px`;
                }
            } catch (err) {
                console.error("Datenfehler:", err);
            }
        };

        // Animation (60 FPS)
        function updatePosition() {
            currentX += (targetX - currentX) * 0.3;
            currentY += (targetY - currentY) * 0.3;
            
            pointer.style.transform = `translate(calc(-50% + ${currentX}px), calc(-50% + ${currentY}px))`;
            
            requestAnimationFrame(updatePosition);
        }
        updatePosition();

        // Responsive
        window.addEventListener('resize', () => {
            sensitivity = window.innerWidth / (MAX_ANGLE * 2);
        });
    </script>
</body>
</html>
