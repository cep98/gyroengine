<!DOCTYPE html>
<html>
<head>
    <title>Laserpointer</title>
    <style>
        /* CSS unverÃ¤ndert */
    </style>
</head>
<body>
    <div id="pointer"></div>
    <div id="debug">Initialisiere...</div>

    <script>
        const pointer = document.getElementById("pointer");
        const debug = document.getElementById("debug");
        const socket = new WebSocket("wss://gyroengine.onrender.com");

        // Einstellungen
        const MAX_ANGLE = 20;
        let targetX = 0, targetY = 0;
        let currentX = 0, currentY = 0;

        function calculateSensitivity() {
            return Math.min(window.innerWidth, window.innerHeight) / (MAX_ANGLE * 2);
        }
        let sensitivity = calculateSensitivity();

        socket.onopen = () => debug.textContent = "Verbunden | Warte auf Daten";
        socket.onerror = (e) => debug.textContent = `Fehler: ${e.message}`;
        
        socket.onmessage = (e) => {
            try {
                const data = JSON.parse(e.data);
                
                if (data.reset) {
                    targetX = targetY = 0;
                    debug.textContent = "Zentriert | Warte auf Daten";
                } 
                else if (data.alpha !== undefined) {
                    // KORREKTUR: Richtung umgekehrt (-1 fÃ¼r beide Achsen)
                    let horizontalAngle = (data.alpha > 180) ? data.alpha - 360 : data.alpha;
                    horizontalAngle = Math.max(-MAX_ANGLE, Math.min(MAX_ANGLE, horizontalAngle)) * -1; // ðŸ‘ˆ Hier -1
                    
                    const verticalAngle = Math.max(-MAX_ANGLE, Math.min(MAX_ANGLE, data.beta)) * -1; // ðŸ‘ˆ Hier -1
                    
                    targetX = horizontalAngle * sensitivity;
                    targetY = verticalAngle * sensitivity * 0.8;
                    
                    debug.innerHTML = `
                        Alpha: ${horizontalAngle.toFixed(1)}Â°<br>
                        Beta: ${verticalAngle.toFixed(1)}Â°<br>
                        X: ${targetX.toFixed(1)}px | Y: ${targetY.toFixed(1)}px
                    `;
                }
            } catch (err) {
                debug.textContent = `Datenfehler: ${err.message}`;
            }
        };

        function animate() {
            currentX += (targetX - currentX) * 0.2;
            currentY += (targetY - currentY) * 0.2;
            
            pointer.style.transform = `translate(calc(-50% + ${currentX}px), calc(-50% + ${currentY}px)`;
            requestAnimationFrame(animate);
        }
        animate();

        window.addEventListener('resize', () => {
            sensitivity = calculateSensitivity();
        });
    </script>
</body>
</html>
