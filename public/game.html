<!DOCTYPE html>
<html>
<head>
    <title>Laserpointer Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #111;
        }
        #pointer {
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, red 20%, transparent 70%);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            filter: drop-shadow(0 0 10px red);
            transition: transform 0.05s linear;
        }
        #debug {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div id="pointer"></div>
    <div id="debug">Verbinde mit Server...</div>

    <script>
        const pointer = document.getElementById("pointer");
        const debug = document.getElementById("debug");
        const socket = new WebSocket("wss://gyroengine.onrender.com");

        // Einstellungen
        const SENSITIVITY = 4;
        const SMOOTHING = 0.2;
        let targetX = 0, targetY = 0;
        let currentX = 0, currentY = 0;

        // WebSocket
        socket.onopen = () => debug.textContent = "VERBUNDEN | Warte auf Gyro-Daten";
        socket.onerror = (e) => debug.textContent = "FEHLER: " + e.message;
        
        socket.onmessage = (e) => {
            try {
                const data = JSON.parse(e.data);
                
                if (data.reset) {
                    targetX = targetY = 0;
                    debug.textContent = "ZENTRIERT | Warte auf Gyro-Daten";
                } 
                else if (data.beta !== undefined) {
                    targetX = data.gamma * SENSITIVITY;
                    targetY = data.beta * SENSITIVITY * 0.8;
                    debug.innerHTML = `X: ${targetX.toFixed(1)} | Y: ${targetY.toFixed(1)}<br>`;
                }
            } catch (err) {
                console.error("Datenfehler:", err);
            }
        };

        // Animation
        function animate() {
            currentX += (targetX - currentX) * SMOOTHING;
            currentY += (targetY - currentY) * SMOOTHING;
            
            pointer.style.transform = `
                translate(calc(-50% + ${currentX}px), 
                         calc(-50% + ${currentY}px))
            `;
            
            requestAnimationFrame(animate);
        }
        animate();
    </script>
</body>
</html>
