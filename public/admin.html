<!DOCTYPE html>
<html>
<head>
    <title>Admin Monitor</title>
    <style>
        body {
            font-family: Arial;
            padding: 20px;
            background: #f5f5f5;
        }
        .panel {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .bar-container {
            height: 30px;
            background: #eee;
            margin: 10px 0;
            border-radius: 4px;
            overflow: hidden;
        }
        .bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 50%;
            transition: width 0.3s;
        }
        #dataLog {
            height: 200px;
            overflow-y: auto;
            background: #222;
            color: #0f0;
            font-family: monospace;
            padding: 10px;
            border-radius: 4px;
        }
        #connectionStatus {
            display: inline-block;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: gray;
            margin-right: 10px;
        }
        .connected { background: #4CAF50 !important; }
        .error { background: #f44336 !important; }
    </style>
</head>
<body>
    <h1><span id="connectionStatus"></span>Gyro Data Monitor</h1>
    
    <div class="panel">
        <h3>Echtzeit-Daten</h3>
        <div>
            <label>Beta (Vor/Zurück):</label>
            <div class="bar-container">
                <div id="betaBar" class="bar"></div>
            </div>
            <span id="betaValue">0°</span>
        </div>
        <div>
            <label>Gamma (Links/Rechts):</label>
            <div class="bar-container">
                <div id="gammaBar" class="bar"></div>
            </div>
            <span id="gammaValue">0°</span>
        </div>
    </div>
    
    <div class="panel">
        <h3>Datenprotokoll</h3>
        <div id="dataLog">Verbindung wird hergestellt...</div>
    </div>

    <script>
        const socket = new WebSocket("wss://gyroengine.onrender.com");
        const statusLed = document.getElementById("connectionStatus");
        const betaBar = document.getElementById("betaBar");
        const gammaBar = document.getElementById("gammaBar");
        const betaValue = document.getElementById("betaValue");
        const gammaValue = document.getElementById("gammaValue");
        const dataLog = document.getElementById("dataLog");

        // WebSocket-Events
        socket.onopen = () => {
            statusLed.className = "connected";
            logMessage("VERBUNDEN MIT SERVER");
        };

        socket.onerror = (err) => {
            statusLed.className = "error";
            logMessage(`FEHLER: ${err.message || "Keine Verbindung"}`);
        };

        socket.onmessage = (e) => {
            try {
                const data = JSON.parse(e.data);
                
                if (data.reset) {
                    logMessage("RESET: Pointer zentriert");
                }
                else if (data.beta !== undefined) {
                    // Balken aktualisieren (-90° bis +90°)
                    updateBar(betaBar, data.beta, 90);
                    updateBar(gammaBar, data.gamma, 90);
                    
                    // Werte anzeigen
                    betaValue.textContent = `${data.beta.toFixed(1)}°`;
                    gammaValue.textContent = `${data.gamma.toFixed(1)}°`;
                    
                    // Protokoll
                    logMessage(`BETA: ${data.beta.toFixed(1)}° | GAMMA: ${data.gamma.toFixed(1)}°`);
                }
            } catch (err) {
                logMessage(`PARSING-FEHLER: ${err}`);
            }
        };

        function updateBar(bar, value, max) {
            const percent = ((value + max) / (max * 2)) * 100;
            bar.style.width = `${percent}%`;
            
            // Farbe bei Extremwerten ändern
            if (Math.abs(value) > max * 0.8) {
                bar.style.background = "linear-gradient(90deg, #FF5722, #F44336)";
            } else {
                bar.style.background = "linear-gradient(90deg, #4CAF50, #8BC34A)";
            }
        }

        function logMessage(msg) {
            const now = new Date();
            const timestamp = now.toLocaleTimeString();
            dataLog.innerHTML += `[${timestamp}] ${msg}<br>`;
            dataLog.scrollTop = dataLog.scrollHeight;
        }
    </script>
</body>
</html>
