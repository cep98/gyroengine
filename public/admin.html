<!DOCTYPE html>
<html>
<head>
    <title>Admin Monitor</title>
    <style>
        body {
            font-family: Arial;
            padding: 20px;
            background: #f5f5f5;
        }
        .panel {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .bar-container {
            height: 30px;
            background: #eee;
            margin: 10px 0;
            border-radius: 4px;
            overflow: hidden;
        }
        .bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 50%;
            transition: width 0.3s;
        }
        #dataLog {
            height: 200px;
            overflow-y: auto;
            background: #222;
            color: #0f0;
            font-family: monospace;
            padding: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
        }
        .status {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .connected { background: #4CAF50; }
        .disconnected { background: #f44336; }
    </style>
</head>
<body>
    <h1><span id="statusLed" class="status disconnected"></span>Gyro Monitor</h1>
    
    <div class="panel">
        <h3>Echtzeit-Daten</h3>
        <div>
            <label>Alpha (Horizontal):</label>
            <div class="bar-container">
                <div id="alphaBar" class="bar"></div>
            </div>
            <span id="alphaValue">0°</span>
        </div>
        <div>
            <label>Beta (Vertikal):</label>
            <div class="bar-container">
                <div id="betaBar" class="bar"></div>
            </div>
            <span id="betaValue">0°</span>
        </div>
    </div>
    
    <div class="panel">
        <h3>Datenstrom</h3>
        <div id="dataLog">Initialisiere WebSocket...</div>
    </div>

    <script>
        const socket = new WebSocket("wss://gyroengine.onrender.com");
        const statusLed = document.getElementById("statusLed");
        const alphaBar = document.getElementById("alphaBar");
        const betaBar = document.getElementById("betaBar");
        const alphaValue = document.getElementById("alphaValue");
        const betaValue = document.getElementById("betaValue");
        const dataLog = document.getElementById("dataLog");

        // Konfiguration
        const MAX_ANGLE = 20;

        // WebSocket-Events
        socket.onopen = () => {
            statusLed.className = "status connected";
            logMessage("VERBUNDEN MIT SERVER");
        };

        socket.onerror = (err) => {
            statusLed.className = "status disconnected";
            logMessage(`FEHLER: ${err.message || "Keine Verbindung"}`);
        };

        socket.onmessage = (e) => {
            try {
                const data = JSON.parse(e.data);
                
                if (data.reset) {
                    logMessage("--- POINTER ZENTRIERT ---");
                    updateBars(0, 0);
                }
                else if (data.alpha !== undefined) {
                    // Alpha zu -180° bis 180° konvertieren
                    let alpha = (data.alpha > 180) ? data.alpha - 360 : data.alpha;
                    alpha = Math.max(-MAX_ANGLE, Math.min(MAX_ANGLE, alpha));
                    
                    // Beta begrenzen
                    const beta = Math.max(-MAX_ANGLE, Math.min(MAX_ANGLE, data.beta));
                    
                    updateBars(alpha, beta);
                    logMessage(`ALPHA: ${alpha.toFixed(1)}° | BETA: ${beta.toFixed(1)}°`);
                }
            } catch (err) {
                logMessage(`PARSING-FEHLER: ${err.message}`);
            }
        };

        function updateBars(alpha, beta) {
            // Alpha-Balken (Horizontal)
            const alphaPercent = ((alpha + MAX_ANGLE) / (MAX_ANGLE * 2)) * 100;
            alphaBar.style.width = `${alphaPercent}%`;
            alphaValue.textContent = `${alpha.toFixed(1)}°`;
            
            // Beta-Balken (Vertikal)
            const betaPercent = ((beta + MAX_ANGLE) / (MAX_ANGLE * 2)) * 100;
            betaBar.style.width = `${betaPercent}%`;
            betaValue.textContent = `${beta.toFixed(1)}°`;
            
            // Farben bei Extremwerten
            if (Math.abs(alpha) > MAX_ANGLE * 0.9) {
                alphaBar.style.background = "linear-gradient(90deg, #FF9800, #FF5722)";
            } else {
                alphaBar.style.background = "linear-gradient(90deg, #4CAF50, #8BC34A)";
            }
            
            if (Math.abs(beta) > MAX_ANGLE * 0.9) {
                betaBar.style.background = "linear-gradient(90deg, #FF9800, #FF5722)";
            }
        }

        function logMessage(msg) {
            const now = new Date();
            const timeStr = now.toLocaleTimeString();
            dataLog.innerHTML += `[${timeStr}] ${msg}\n`;
            dataLog.scrollTop = dataLog.scrollHeight;
        }
    </script>
</body>
</html>
